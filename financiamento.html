<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Financiamento - Salvo</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; padding:20px; }
.container { max-width:800px; margin:0 auto; background:white; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.3); overflow:hidden; }
.header { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); padding:40px; color:white; }
.header h1 { font-size:32px; margin-bottom:8px; }
.tabs { display:flex; gap:10px; padding:20px; background:#f8f9fa; border-bottom:2px solid #e9ecef; }
.tab { padding:12px 24px; border:none; background:transparent; border-radius:8px; cursor:pointer; font-size:16px; font-weight:600; color:#6c757d; transition: all 0.3s; }
.tab:hover { background:white; }
.tab.active { background:white; color:#667eea; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.content { padding:30px; }
.tab-content { display:none; }
.tab-content.active { display:block; }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
.stat-card { padding:25px; border-radius:12px; color:white; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
.stat-card.green { background:linear-gradient(135deg,#10b981 0%,#059669 100%); }
.stat-card.red { background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%); }
.stat-card.blue { background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%); }
.stat-card h3 { font-size:14px; opacity:0.9; margin-bottom:10px; }
.stat-card .value { font-size:32px; font-weight:bold; margin-bottom:5px; }
.stat-card .subtitle { font-size:13px; opacity:0.8; }
.form-group { margin-bottom:20px; }
.form-group label { display:block; font-weight:600; margin-bottom:8px; color:#333; }
.form-group input { width:100%; padding:12px 15px; border:2px solid #e9ecef; border-radius:8px; font-size:16px; transition:border-color 0.3s; }
.form-group input:focus { outline:none; border-color:#667eea; }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.btn { padding:15px 30px; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; transition:all 0.3s; }
.btn-primary { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; width:100%; }
.btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(102,126,234,0.4); }
.btn-success { background:#10b981; color:white; margin-top:10px; }
.btn-danger { background:#ef4444; color:white; padding:8px 16px; font-size:14px; }
.progress-bar { background:#e9ecef; height:20px; border-radius:10px; overflow:hidden; margin:20px 0; }
.progress-fill { background:linear-gradient(90deg,#667eea 0%,#764ba2 100%); height:100%; transition:width 0.5s; display:flex; align-items:center; justify-content:center; color:white; font-weight:600; font-size:12px; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th { background:#f8f9fa; padding:12px; text-align:left; font-weight:600; color:#333; border-bottom:2px solid #e9ecef; }
td { padding:12px; border-bottom:1px solid #e9ecef; }
tr:hover { background:#f8f9fa; }
tr.paid { background:#d1fae5; }
.btn-status { padding:6px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600; font-size:14px; }
.btn-status.paid { background:#d1fae5; color:#059669; }
.btn-status.pending { background:#f3f4f6; color:#6b7280; }
.chart-container { background:white; padding:20px; border-radius:12px; border:2px solid #e9ecef; margin-top:20px; }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>🚗 Controle de Financiamento</h1>
        <p>Controle suas parcelas e entenda sobre amortização</p>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('dashboard', event)">📊 Dashboard</button>
        <button class="tab" onclick="switchTab('parcelas', event)">💳 Minhas Parcelas</button>
    </div>

    <div class="content">
        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="form-group">
                <label>Nome do Veículo</label>
                <input type="text" id="vehicleName" placeholder="Ex: Honda Civic 2023" value="Meu Veículo">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Valor da Parcela (R$)</label>
                    <input type="number" id="installmentValue" placeholder="Ex: 1200.00" value="725">
                </div>
                <div class="form-group">
                    <label>Número Total de Parcelas</label>
                    <input type="number" id="totalInstallments" placeholder="Ex: 48" value="48">
                </div>
            </div>

            <button class="btn btn-primary" onclick="generateInstallments()">
                Criar Controle de Parcelas
            </button>

            <div id="statsSection" style="display: none; margin-top: 40px;">
                <h2 id="vehicleTitle" style="margin-bottom: 30px; color: #333;"></h2>
                
                <div class="stats-grid">
                    <div class="stat-card green">
                        <h3>Parcelas Pagas</h3>
                        <div class="value" id="paidCount">0</div>
                        <div class="subtitle" id="paidValue">R$ 0,00</div>
                    </div>
                    <div class="stat-card red">
                        <h3>Parcelas Pendentes</h3>
                        <div class="value" id="pendingCount">0</div>
                        <div class="subtitle" id="pendingValue">R$ 0,00</div>
                    </div>
                    <div class="stat-card blue">
                        <h3>Total do Financiamento</h3>
                        <div class="value" id="totalValue">R$ 0,00</div>
                        <div class="subtitle">Valor completo</div>
                    </div>
                    <div class="stat-card" id="debtCard" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                        <h3>Dívida Restante</h3>
                        <div class="value" id="debtValue">R$ 22.000,00</div>
                        <div class="subtitle">Quanto ainda falta pagar</div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="font-weight: 600; color: #333;">Progresso do Pagamento</span>
                        <span id="progressPercent" style="font-size: 24px; font-weight: 700; color: #667eea;">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 20px; color: #333;">Evolução dos Pagamentos</h3>
                    <canvas id="progressChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Parcelas -->
        <div id="parcelas" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 24px; color: #333;">Controle de Parcelas</h2>
                <button class="btn btn-success" onclick="addInstallment()">+ Adicionar Parcela</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Nº</th>
                            <th>Vencimento</th>
                            <th style="text-align: right;">Valor</th>
                            <th style="text-align: center;">Status</th>
                            <th style="text-align: center;">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="installmentsBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
let installments = [];
let vehicleName = '';
let installmentValue = 0;
let progressChart = null;
const totalDebt = 22000;

function switchTab(tabName, evt) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    evt.target.classList.add('active');
    document.getElementById(tabName).classList.add('active');
}

function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(value);
}

function generateInstallments() {
    vehicleName = document.getElementById('vehicleName').value || 'Meu Veículo';
    installmentValue = parseFloat(document.getElementById('installmentValue').value);
    const total = parseInt(document.getElementById('totalInstallments').value);
    if(!installmentValue || !total){ alert('Preencha todos os campos!'); return; }

    installments=[];
    const startDate = new Date(2025,7,10);
    for(let i=1;i<=total;i++){
        const dueDate = new Date(startDate);
        dueDate.setMonth(startDate.getMonth() + (i-1));
        const dueDateStr = dueDate.getFullYear()+'-'+String(dueDate.getMonth()+1).padStart(2,'0')+'-'+String(dueDate.getDate()).padStart(2,'0');
        installments.push({number:i,value:installmentValue,dueDate:dueDateStr,paid:false});
    }

    updateDashboard();
    renderInstallments();
    document.getElementById('statsSection').style.display='block';
    saveData();
}

function addInstallment(){
    const newNumber = installments.length+1;
    installments.push({number:newNumber,value:installmentValue||0,dueDate:'',paid:false});
    renderInstallments();
    updateDashboard();
    saveData();
}

function togglePayment(index){
    installments[index].paid=!installments[index].paid;
    renderInstallments();
    updateDashboard();
    saveData();
}

function deleteInstallment(index){
    if(confirm('Tem certeza que deseja excluir esta parcela?')){
        installments.splice(index,1);
        installments.forEach((inst,i)=>inst.number=i+1);
        renderInstallments();
        updateDashboard();
        saveData();
    }
}

function updateDueDate(index,value){
    installments[index].dueDate=value;
    saveData();
}

function renderInstallments(){
    const tbody=document.getElementById('installmentsBody');
    tbody.innerHTML='';
    installments.forEach((inst,i)=>{
        const row=tbody.insertRow();
        row.className=inst.paid?'paid':'';
        row.innerHTML=
        `<td style="font-weight:600;">${inst.number}</td>
        <td style="font-weight:500;">${formatDate(inst.dueDate)}</td>
        <td style="text-align:right;font-weight:600;">${formatCurrency(inst.value)}</td>
        <td style="text-align:center;">
        <button class="btn-status ${inst.paid?'paid':'pending'}" onclick="togglePayment(${i})">${inst.paid?'✓ Paga':'⏳ Pendente'}</button>
        </td>
        <td style="text-align:center;">
        <button class="btn btn-danger" onclick="deleteInstallment(${i})">🗑️</button>
        </td>`;
    });
}

function formatDate(dateStr){ if(!dateStr) return '-'; const parts=dateStr.split('-'); return `${parts[2]}/${parts[1]}/${parts[0]}`;}

function updateDashboard(){
    let paidCount=0, pendingCount=0, paidValue=0, pendingValue=0;
    installments.forEach(inst=>{ if(inst.paid){ paidCount++; paidValue+=inst.value; }else{ pendingCount++; pendingValue+=inst.value; }});
    const totalValue=paidValue+pendingValue;
    const progress=installments.length>0?(paidCount/installments.length*100).toFixed(1):0;

    document.getElementById('vehicleTitle').textContent=vehicleName;
    document.getElementById('paidCount').textContent=paidCount;
    document.getElementById('paidValue').textContent=formatCurrency(paidValue);
    document.getElementById('pendingCount').textContent=pendingCount;
    document.getElementById('pendingValue').textContent=formatCurrency(pendingValue);
    document.getElementById('totalValue').textContent=formatCurrency(totalValue);
    document.getElementById('progressPercent').textContent=progress+'%';
    document.getElementById('progressFill').style.width=progress+'%';

    // Atualiza dívida restante
    const remainingDebt = totalDebt - paidValue;
    document.getElementById('debtValue').textContent=formatCurrency(remainingDebt);
    const greenPercent = Math.min(100,(paidValue/totalDebt)*100);
    document.getElementById('debtCard').style.background=`linear-gradient(135deg,#10b981 ${greenPercent}%,#ef4444 ${greenPercent}%)`;

    renderChart(paidCount,pendingCount);
}

function renderChart(paid,pending){
    const ctx=document.getElementById('progressChart').getContext('2d');
    if(progressChart) progressChart.destroy();
    progressChart=new Chart(ctx,{
        type:'doughnut',
        data:{ labels:['Pagas','Pendentes'], datasets:[{ data:[paid,pending], backgroundColor:['#10b981','#ef4444'], borderWidth:0 }] },
        options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
    });
}

// ====== LOCAL STORAGE ======
function saveData(){
    localStorage.setItem('financingData',JSON.stringify({vehicleName,installmentValue,installments}));
}

function loadData(){
    const saved=localStorage.getItem('financingData');
    if(saved){
        const data=JSON.parse(saved);
        vehicleName=data.vehicleName;
        installmentValue=data.installmentValue;
        installments=data.installments;
        document.getElementById('vehicleName').value=vehicleName;
        document.getElementById('installmentValue').value=installmentValue;
        renderInstallments();
        updateDashboard();
        document.getElementById('statsSection').style.display='block';
    }
}

window.onload=loadData;
</script>
</body>
</html>
